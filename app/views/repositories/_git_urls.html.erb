<% if repository && repository.is_a?(Repository::Git) && RedmineGitolite::Config.show_repositories_url? %>

  <div class="box">

    <div id="git_url_box">
      <h3>Repository Access Links:</h3>

      <ul id="git_url_list">
        <% repository.available_urls.each do |key, value| %>
          <li id="git_url_<%= key %>">
            <a href="javascript:void(0)"><%= key.upcase %></a>
          </li>
        <% end %>
      </ul>

      <input id="git_url_text" readonly="readonly" class="git_url_text_big" />

      <div id="clipboard_container">
        <div id="clipboard_button" data-clipboard-target="git_url_text" title="<%= l(:label_copy_to_clipboard) %>">
          <%= image_tag 'paste.png', :plugin => 'redmine_git_hosting' %>
        </div>
      </div>

    </div>

    <br />
    <br />
    <span id="git_url_desc">This URL has <span id="git_url_permissions">Read-Only</span> access.</span>
  </div>

<% end %>

<% content_for :header_tags do %>
  <%= stylesheet_link_tag    'git_urls',                   :plugin => 'redmine_git_hosting' %>
  <%= javascript_include_tag 'plugins/zero_clipboard_min', :plugin => 'redmine_git_hosting' %>

  <%= javascript_tag do %>
    var urls = [];

    <% repository.available_urls.each do |key, value| %>
    urls["git_url_<%= key %>"] = [encodeURI("<%= j value[:url] %>"), <%= j value[:commiter] %> ];
    <% end %>

    $(document).ready(function() {
      ZeroClipboard.config({ moviePath: "<%= plugin_asset_link('ZeroClipboard.swf') %>" });
      var client = new ZeroClipboard($('#clipboard_button'));

      $('#git_url_list li').first().addClass('selected');
      var key = $('#git_url_list li').first().attr('id');
      var text = urls[key];

      $('#git_url_text').val(text[0]);
      $('.git_url_access').html(text[0]);
      $("#git_url_permissions").html(text[1] ? "Read+Write" : "Read-Only");

      $('#git_url_list li').on('click', function(){
        var key  = $(this).attr('id');
        var text = urls[key];

        $('#git_url_list li').removeClass('selected');
        $(this).addClass('selected');
        $('#git_url_text').val(text[0]);
        $('.git_url_access').html(text[0]);
        $("#git_url_permissions").html(text[1] ? "Read+Write" : "Read-Only");

        if (key == 'git_url_git') {
          $('#repository_setup').hide();
        } else {
          $('#repository_setup').show();
        }
      });
    });
  <% end %>
<% end %>
